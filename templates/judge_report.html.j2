<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Judge Report</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 1100px; margin: 2rem auto; line-height: 1.5; color: #111; }
    h1, h2 { margin-bottom: 0.4rem; }
    .meta { color: #555; margin-bottom: 1rem; }
    table { border-collapse: collapse; width: 100%; margin: 0.75rem 0 1.5rem; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; }
    th { background: #f7f7f7; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .section { margin-top: 1.5rem; }
  </style>
</head>
<body>
  <h1>Judge Report</h1>
  <div class="meta">
    <div><strong>Source:</strong> {{ input_path }}</div>
    <div><strong>Total records:</strong> {{ summary.total }}</div>
    <div><strong>Parse errors:</strong> {{ summary.parse_errors }}</div>
  </div>

  <div class="section">
    <h2>Counts by Rubric</h2>
    <table>
      <tr><th>Rubric</th><th>Records</th></tr>
      {% for rubric, count in summary.by_rubric.items() %}
      <tr><td>{{ rubric }}</td><td>{{ count }}</td></tr>
      {% endfor %}
    </table>
  </div>

  <div class="section">
    <h2>Winner Counts by Judge & Pair</h2>
    {% for judge, pairs in summary.by_judge.items() %}
      <h3>{{ judge }}</h3>
      <table>
        <tr><th>Pair</th><th>A</th><th>B</th><th>tie</th><th>unknown</th></tr>
        {% for pair, counts in pairs.items() %}
        <tr>
          <td>{{ pair }}</td>
          <td>{{ counts.get('A', 0) }}</td>
          <td>{{ counts.get('B', 0) }}</td>
          <td>{{ counts.get('tie', 0) }}</td>
          <td>{{ counts.get('unknown', 0) }}</td>
        </tr>
        {% endfor %}
      </table>
    {% endfor %}
  </div>

  <div class="section">
    <h2>Sample Records (first 20)</h2>
    {% for rec in records[:20] %}
      <div style="border:1px solid #e0e0e0; border-radius:6px; padding:0.75rem; margin-bottom:0.75rem;">
        <div><strong>ID:</strong> {{ rec.id }}</div>
        <div><strong>Prompt:</strong> {{ rec.prompt }}</div>
        <div><strong>Judge:</strong> {{ rec.judge_model }} | <strong>Rubric:</strong> {{ rec.rubric }} | <strong>Pair:</strong> {{ rec.pair }}</div>
        <div><strong>Winner:</strong> {{ rec.get('winner', 'n/a') }}</div>
        <div><strong>A label/format:</strong> {{ rec.get('a_label') }} / {{ rec.get('a_format_ok') }}</div>
        <div><strong>B label/format:</strong> {{ rec.get('b_label') }} / {{ rec.get('b_format_ok') }}</div>
        <div><strong>Reason:</strong> {{ rec.get('reason') }}</div>
        {% if rec.get('parse_error') %}<div style="color:#b00020;">Parse error; raw output kept.</div>{% endif %}
      </div>
    {% endfor %}
  </div>
</body>
</html>
