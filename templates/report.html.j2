<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Smoke Test Report</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 900px; margin: 2rem auto; line-height: 1.5; color: #111; }
    h1, h2 { margin-bottom: 0.25rem; }
    .meta { color: #555; margin-bottom: 1rem; }
    table { border-collapse: collapse; width: 100%; margin: 0.5rem 0 1rem; }
    th, td { border: 1px solid #ddd; padding: 6px 8px; text-align: left; }
    th { background: #f7f7f7; }
    .fail { color: #b00020; }
    .pass { color: #0a7d24; }
    .card { border: 1px solid #e0e0e0; border-radius: 6px; padding: 0.75rem; margin-bottom: 0.75rem; }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body>
  <h1>Smoke Test Report</h1>
  <div class="meta">
    <div><strong>Model:</strong> {{ model }}</div>
    <div><strong>Dataset:</strong> {{ dataset }}</div>
    <div><strong>Run name:</strong> {{ run_name or "n/a" }}</div>
    <div><strong>Timestamp:</strong> {{ timestamp }}</div>
  </div>

  <h2>Summary</h2>
  <ul>
    <li>Total: {{ stats.total_tests }}</li>
    <li>Passed: {{ stats.passed }} ({{ "%.1f"|format(stats.pass_rate) }}%)</li>
    <li>Failed: {{ stats.failed }}</li>
    {% if stats.latency.mean %}
    <li>Latency p50/p95: {{ "%.2f"|format(stats.latency.p50) }}s / {{ "%.2f"|format(stats.latency.p95) }}s</li>
    {% endif %}
    {% if stats.tokens_per_sec %}
    <li>Throughput: {{ "%.1f"|format(stats.tokens_per_sec) }} tokens/sec</li>
    {% endif %}
  </ul>

  <h2>Results by Tag</h2>
  {% if stats.by_tag %}
  <table>
    <tr><th>Tag</th><th>Pass Rate</th><th>Passed/Total</th></tr>
    {% for tag, t in stats.by_tag.items() %}
    <tr>
      <td>{{ tag }}</td>
      <td>{{ "%.1f"|format(t.pass_rate) }}%</td>
      <td>{{ t.passed }}/{{ t.total }}</td>
    </tr>
    {% endfor %}
  </table>
  {% else %}
  <p>(no tags)</p>
  {% endif %}

  <h2>Failed Tests</h2>
  {% if failed %}
    {% for r in failed %}
    <div class="card">
      <div><strong>{{ r.id }}</strong> â€” {{ r.prompt[:200] }}</div>
      <div class="fail">Reason: {{ r.reason }}</div>
      {% if r.response %}
      <div><code>{{ r.response[:600].replace("\n", " ") }}</code></div>
      {% else %}
      <div>(no response)</div>
      {% endif %}
    </div>
    {% endfor %}
  {% else %}
  <p>No failures ðŸŽ‰</p>
  {% endif %}
</body>
</html>
